
对于一个随机 trajectory:

$$S_t \xrightarrow{A_t} R_{t+1}, S_{t+1} \xrightarrow R_{t+2}, S_{t+2} \xrightarrow{A_{t+2}} R_{t+3}, ...$$

折扣价值回报 $G_t$:

$$G_t=R_{t+1}+\gamma R_{t=2} + \gamma^2 R_{t+3} + ...$$
$$=R_{t+1} + \gamma(R_{t+2} + \gamma R_{t+3}+ ...)$$
$$= R_{t+1} + \gamma G_{t+1}$$


状态价值函数：

$$v_{\pi}(s)=E[G_t|S_t = s]$$
$$=E[R_{t+1} + \gamma G_{t+1} | S_t = s]$$
$$=E[R_{t+1}|S_t=s]+\gamma E[G_{t+1}|S_t = s]$$

分别分析两个， 先看第一个 $E[R_{t+1}|S_t = s]$，其含义是在当前时刻 $t$，处在状态 $s$，获取的回报是 $R_{t+1}$，其计算方式如下：

$$E[R_{t+1}|S_t = s] = \sum_{a}{\pi(a|s)}E[R_{t+1}|S_t=s, A_t=a]$$

$$=\sum_{a}{\pi{(a|s)}\sum_{r}{p(r|s, a)r}}$$


第二项： $E[G_{t+1}|S_t = s]$

$$E[G_{t+1}|S_t = s]=\sum_{s'}{E[G_{t+1}|S_t = s, S_{t+1} = s']p(s' | s)}$$
$$=\sum_{s'}{E[G_{t+1}|S_{t+1}=s']p(s'|s)}$$
$$=\sum_{s'}{v_{\pi}{(s')p(s'|s)}}$$
$$\sum_{s'}v_{\pi}{(s')}\sum_{a}{p(s'|s,a)\pi(a|s)}$$
